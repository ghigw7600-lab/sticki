<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sticki</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#20C997">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Sticki">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&family=Nanum+Pen+Script&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        :root {
            --primary: #20C997;
            --primary-light: #E6FCF5;
            --primary-dark: #12B886;
            --bg: #F8F9FA;
            --bg-dark: #1A1A2E;
            --bg-white: #FFFFFF;
            --text: #212529;
            --text-sub: #868E96;
            --border: #E9ECEF;
            --danger: #FA5252;
            --success: #20C997;
            --warning: #FAB005;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
            
            --postit-yellow: #FFF9DB;
            --postit-pink: #FFDEEB;
            --postit-blue: #D0EBFF;
            --postit-green: #D3F9D8;
            --postit-orange: #FFE8CC;
            --postit-purple: #E5DBFF;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.5;
        }

        .app { max-width: 1400px; margin: 0 auto; min-height: 100vh; }

        /* í—¤ë” */
        .header {
            background: var(--bg-white);
            padding: 14px 20px;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo { display: flex; align-items: center; gap: 10px; }
        .logo-icon {
            width: 32px;
            height: 32px;
            background: var(--primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .logo-icon::after {
            content: '';
            width: 16px;
            height: 16px;
            background: var(--bg-white);
            border-radius: 2px;
            transform: rotate(-5deg);
        }
        .logo h1 { font-size: 20px; font-weight: 700; color: var(--text); }
        .logo h1 span { color: var(--primary); }

        .header-right { display: flex; align-items: center; gap: 12px; }
        .header-date { font-size: 13px; color: var(--text-sub); }
        .sync-badge { display: flex; align-items: center; gap: 5px; font-size: 11px; color: var(--text-sub); padding: 5px 10px; background: var(--bg); border-radius: 12px; }
        .sync-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--primary); }
        .sync-dot.off { background: var(--danger); }
        .icon-btn { width: 34px; height: 34px; border: none; background: var(--bg); border-radius: 8px; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--text-sub); }
        .icon-btn:hover { background: var(--border); color: var(--text); }
        .icon-btn.active { background: var(--primary-light); color: var(--primary); }

        /* íƒ­ */
        .tabs {
            display: flex;
            gap: 4px;
            padding: 10px 20px;
            background: var(--bg-white);
            border-bottom: 1px solid var(--border);
            overflow-x: auto;
        }

        .tab {
            padding: 8px 16px;
            border: none;
            background: none;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-sub);
            cursor: pointer;
            border-radius: 6px;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tab:hover { background: var(--bg); }
        .tab.active { background: var(--primary); color: white; }
        .tab .icon { font-size: 15px; }

        /* ë©”ì¸ */
        .main { padding: 16px; }
        .screen { display: none; }
        .screen.active { display: block; }

        /* ì…ë ¥ */
        .input-box {
            background: var(--bg-white);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: var(--shadow-sm);
        }

        .input-box textarea {
            width: 100%;
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 14px 16px;
            font-size: 14px;
            font-family: inherit;
            resize: none;
            height: 70px;
            outline: none;
            transition: border-color 0.2s;
        }

        .input-box textarea:focus { border-color: var(--primary); }
        .input-box textarea::placeholder { color: #ADB5BD; }

        .input-btns { display: flex; gap: 8px; margin-top: 12px; }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
            font-family: inherit;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn:active { transform: scale(0.97); }
        .btn-primary { background: var(--primary); color: white; flex: 1; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-light { background: var(--bg); color: var(--text); }
        .btn-light:hover { background: var(--border); }
        .btn-danger { background: var(--danger); color: white; }

        /* ì½œë°± íŒ¨ë„ */
        .callback-panel {
            background: linear-gradient(135deg, #FFF5F5 0%, #FFFFFF 100%);
            border: 1px solid #FFC9C9;
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 16px;
        }

        .callback-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .callback-header h3 { font-size: 13px; font-weight: 600; color: var(--danger); display: flex; align-items: center; gap: 6px; }
        .callback-count { background: var(--danger); color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px; font-weight: 600; }
        .callback-list { display: flex; flex-direction: column; gap: 8px; max-height: 280px; overflow-y: auto; padding-right: 4px; }

        .callback-chip {
            background: white;
            border: 1px solid #FFC9C9;
            border-radius: 10px;
            padding: 10px 14px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .callback-chip:hover { background: #FFF0F0; transform: translateX(4px); }
        .callback-chip .time { font-size: 13px; font-weight: 700; color: var(--danger); }
        .callback-chip .name { font-size: 13px; color: var(--text); text-align: right; }

        /* ì¹¼ëŸ¼ */
        .columns { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 16px; }

        .column {
            flex: 1;
            min-width: 240px;
            max-width: 300px;
            background: var(--bg-white);
            border-radius: 16px;
            box-shadow: var(--shadow-sm);
        }

        .col-header {
            padding: 14px 16px;
            border-bottom: 2px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .col-title { font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .col-dot { width: 8px; height: 8px; border-radius: 50%; }
        .column:nth-child(1) .col-dot { background: var(--primary); }
        .column:nth-child(2) .col-dot { background: #FAB005; }
        .column:nth-child(3) .col-dot { background: #7950F2; }
        .column:nth-child(4) .col-dot { background: #12B886; }
        .column:nth-child(5) .col-dot { background: #51CF66; }

        .col-count { background: var(--bg); padding: 4px 10px; border-radius: 10px; font-size: 12px; font-weight: 600; color: var(--text-sub); }
        .col-cards { padding: 12px; min-height: 150px; transition: background 0.2s; }
        .column.drag-over { background: var(--primary-light); box-shadow: inset 0 0 0 2px var(--primary); }

        /* ì¹´ë“œ - ì‹¤ì œ í¬ìŠ¤íŠ¸ì‡ ëŠë‚Œ */
        .card {
            border-radius: 2px;
            padding: 14px 14px 40px 14px;
            margin-bottom: 12px;
            cursor: pointer;
            position: relative;
            transition: transform 0.15s, box-shadow 0.15s, opacity 0.2s;
            box-shadow: 
                2px 2px 4px rgba(0,0,0,0.08),
                0 0 0 1px rgba(0,0,0,0.02);
            border-left: 3px solid rgba(0,0,0,0.05);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, rgba(0,0,0,0.03) 0%, transparent 100%);
        }

        .card:hover { 
            transform: translateY(-4px) rotate(0deg) !important; 
            box-shadow: 4px 6px 12px rgba(0,0,0,0.12); 
            z-index: 5; 
        }
        .card:nth-child(odd) { transform: rotate(-1deg); }
        .card:nth-child(even) { transform: rotate(0.8deg); }
        .card:nth-child(3n) { transform: rotate(-0.5deg); }
        .card.dragging { opacity: 0.4; }

        .card.yellow { background: linear-gradient(135deg, #FFF9DB 0%, #FFF3BF 100%); }
        .card.pink { background: linear-gradient(135deg, #FFDEEB 0%, #FFC9C9 100%); }
        .card.blue { background: linear-gradient(135deg, #D0EBFF 0%, #A5D8FF 100%); }
        .card.green { background: linear-gradient(135deg, #D3F9D8 0%, #B2F2BB 100%); }
        .card.orange { background: linear-gradient(135deg, #FFE8CC 0%, #FFD8A8 100%); }
        .card.purple { background: linear-gradient(135deg, #E5DBFF 0%, #D0BFFF 100%); }

        .card-date { 
            font-size: 10px; 
            color: rgba(0,0,0,0.4); 
            margin-bottom: 8px; 
            font-weight: 500;
            font-family: 'Nanum Pen Script', cursive;
            font-size: 13px;
        }
        .card-title { 
            font-family: 'Nanum Pen Script', cursive; 
            font-size: 22px; 
            margin-bottom: 8px; 
            line-height: 1.2;
            color: rgba(0,0,0,0.85);
            letter-spacing: -0.5px;
        }
        .card-info { 
            font-size: 12px; 
            color: rgba(0,0,0,0.6); 
            margin-bottom: 4px; 
            display: flex; 
            align-items: center; 
            gap: 4px;
            font-family: 'Nanum Pen Script', cursive;
            font-size: 15px;
        }

        .card-badges { display: flex; gap: 4px; flex-wrap: wrap; margin-top: 10px; }
        .badge { font-size: 10px; padding: 3px 8px; border-radius: 10px; font-weight: 500; }
        .badge.callback { background: var(--danger); color: white; }
        .badge.urgent { background: #FF8787; color: white; }
        .badge.deadline { background: #FFA94D; color: white; }

        /* ìƒíƒœë©”ëª¨ - ë„ì¥ ìŠ¤íƒ€ì¼ */
        .card-status {
            position: absolute;
            bottom: 10px;
            right: 10px;
            font-family: 'Nanum Pen Script', cursive;
            font-size: 16px;
            padding: 4px 10px;
            border-radius: 3px;
            transform: rotate(-6deg);
            border: 2.5px solid;
            font-weight: 600;
            letter-spacing: 1px;
            box-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .card-status.red { 
            color: #C0392B; 
            border-color: #C0392B; 
            background: rgba(192,57,43,0.08);
        }
        .card-status.blue { 
            color: #2471A3; 
            border-color: #2471A3; 
            background: rgba(36,113,163,0.08);
        }
        .card-status.purple { 
            color: #7D3C98; 
            border-color: #7D3C98; 
            background: rgba(125,60,152,0.08);
        }
        .card-status.green { 
            color: #1E8449; 
            border-color: #1E8449; 
            background: rgba(30,132,73,0.08);
        }
        .card-status.orange { 
            color: #D35400; 
            border-color: #D35400; 
            background: rgba(211,84,0,0.08);
        }

        .card-staff { display: flex; gap: 4px; margin-top: 8px; flex-wrap: wrap; }
        .staff-tag { font-size: 10px; padding: 2px 6px; border-radius: 6px; background: rgba(0,0,0,0.06); color: rgba(0,0,0,0.5); }

        /* ë©”ì¸ë³´ë“œ */
        .mb-nav { display: flex; justify-content: center; align-items: center; gap: 24px; margin-bottom: 24px; }
        .mb-nav button { width: 44px; height: 44px; border: 1px solid var(--border); background: var(--bg-white); border-radius: 12px; font-size: 18px; cursor: pointer; color: var(--text-sub); }
        .mb-nav button:hover { background: var(--bg); color: var(--text); }
        .mb-nav span { font-size: 16px; font-weight: 600; }

        .day-cards { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }

        .day-card {
            background: var(--bg-white);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .day-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-md); }

        .day-head { padding: 20px; text-align: center; border-bottom: 1px solid var(--border); }
        .day-head.today { background: var(--primary); color: white; }
        .day-head .wd { font-size: 13px; opacity: 0.7; }
        .day-head .d { font-size: 32px; font-weight: 700; margin: 4px 0; }
        .day-head .cnt { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 13px; font-weight: 600; background: var(--danger); color: white; }
        .day-head.today .cnt { background: rgba(255,255,255,0.25); }
        .day-head .cnt.done { background: var(--primary); }
        .day-head.today .cnt.done { background: rgba(255,255,255,0.25); }

        .day-body { padding: 14px; min-height: 100px; }
        .day-item { padding: 10px; border-radius: 6px; margin-bottom: 8px; font-size: 13px; }
        .day-empty { text-align: center; color: var(--text-sub); font-size: 13px; padding: 30px 0; }

        /* ë¡œê·¸ */
        .search-wrap { background: var(--bg-white); border-radius: 16px; padding: 16px; margin-bottom: 16px; box-shadow: var(--shadow-sm); }
        .search-row { display: flex; gap: 8px; }
        .search-row input { flex: 1; padding: 12px 16px; border: 2px solid var(--border); border-radius: 12px; font-size: 15px; font-family: inherit; outline: none; }
        .search-row input:focus { border-color: var(--primary); }
        .filters { display: flex; gap: 8px; margin-top: 12px; }
        .filter { padding: 8px 16px; border: 1px solid var(--border); background: var(--bg-white); border-radius: 20px; font-size: 13px; cursor: pointer; transition: all 0.2s; }
        .filter:hover { border-color: var(--primary); }
        .filter.active { background: var(--primary); color: white; border-color: var(--primary); }

        .log-list { display: flex; flex-direction: column; gap: 10px; }
        .log-item { background: var(--bg-white); border-radius: 12px; padding: 16px; box-shadow: var(--shadow-sm); cursor: pointer; transition: all 0.2s; }
        .log-item:hover { box-shadow: var(--shadow-md); transform: translateX(4px); }
        .log-top { display: flex; justify-content: space-between; margin-bottom: 6px; }
        .log-title { font-size: 15px; font-weight: 600; }
        .log-date { font-size: 12px; color: var(--text-sub); }
        .log-info { font-size: 13px; color: var(--text-sub); }
        .log-stage { display: inline-block; margin-top: 8px; padding: 4px 10px; border-radius: 10px; font-size: 11px; font-weight: 600; background: var(--primary-light); color: var(--primary); }

        /* ì„¤ì • */
        .settings-box { background: var(--bg-white); border-radius: 16px; padding: 20px; margin-bottom: 16px; box-shadow: var(--shadow-sm); }
        .settings-box h3 { font-size: 15px; font-weight: 600; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 8px; }

        .preset-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 10px; margin-bottom: 16px; }
        .preset-btn { padding: 14px 10px; border: 2px solid var(--border); background: var(--bg-white); border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.2s; }
        .preset-btn:hover { border-color: var(--primary); }
        .preset-btn.active { border-color: var(--primary); background: var(--primary-light); }
        .preset-btn .icon { font-size: 24px; margin-bottom: 6px; }
        .preset-btn .name { font-size: 12px; font-weight: 600; }

        .stage-list { display: flex; flex-direction: column; gap: 8px; }
        .stage-item { display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--bg); border-radius: 10px; }
        .stage-item .num { width: 24px; height: 24px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; }
        .stage-item input { flex: 1; padding: 10px 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; font-family: inherit; outline: none; background: white; }
        .stage-item input:focus { border-color: var(--primary); }
        .stage-item .del { width: 28px; height: 28px; border: none; background: none; color: var(--text-sub); cursor: pointer; font-size: 16px; border-radius: 6px; }
        .stage-item .del:hover { background: #FFE3E3; color: var(--danger); }
        .add-stage { width: 100%; padding: 12px; border: 2px dashed var(--border); background: none; border-radius: 10px; color: var(--text-sub); font-size: 14px; cursor: pointer; margin-top: 10px; }
        .add-stage:hover { border-color: var(--primary); color: var(--primary); }

        /* ëª¨ë‹¬ */
        .modal-bg { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 200; padding: 16px; }
        .modal-bg.active { display: flex; }
        .modal { background: var(--bg-white); width: 100%; max-width: 480px; max-height: 90vh; border-radius: 20px; overflow: hidden; animation: modalIn 0.25s; }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        .modal-head { padding: 18px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .modal-head h2 { font-size: 17px; font-weight: 600; }
        .modal-close { width: 32px; height: 32px; border: none; background: var(--bg); border-radius: 8px; font-size: 18px; cursor: pointer; color: var(--text-sub); }
        .modal-close:hover { background: var(--border); color: var(--text); }
        .modal-body { padding: 20px; overflow-y: auto; max-height: calc(90vh - 140px); }
        .modal-foot { padding: 16px 20px; border-top: 1px solid var(--border); display: flex; gap: 10px; justify-content: flex-end; }

        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; font-size: 13px; font-weight: 500; color: var(--text-sub); margin-bottom: 6px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px 14px; border: 1px solid var(--border); border-radius: 10px; font-size: 14px; font-family: inherit; outline: none; background: var(--bg-white); }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { border-color: var(--primary); }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .form-row-3 { grid-template-columns: 1fr 1fr 1fr; }

        .status-chips { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
        .status-chips span { 
            padding: 5px 10px; 
            background: var(--bg); 
            border: 1px solid var(--border); 
            border-radius: 14px; 
            font-size: 12px; 
            cursor: pointer; 
            transition: all 0.15s;
            color: var(--text-sub);
        }
        .status-chips span:hover { background: var(--primary-light); border-color: var(--primary); color: var(--primary); }
        .status-chips span:last-child { background: #FFF5F5; border-color: #FFC9C9; color: var(--danger); }
        .status-chips span:last-child:hover { background: #FFE3E3; }

        /* ì…‹ì—… */
        .setup-bg { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--bg); display: flex; align-items: center; justify-content: center; z-index: 300; padding: 20px; }
        .setup-box { background: var(--bg-white); border-radius: 24px; padding: 32px; max-width: 480px; width: 100%; box-shadow: var(--shadow-md); }
        .setup-box h2 { font-size: 24px; margin-bottom: 8px; display: flex; align-items: center; gap: 12px; }
        .setup-box h2 .logo-icon { width: 40px; height: 40px; }
        .setup-box .sub { color: var(--text-sub); margin-bottom: 24px; font-size: 15px; }
        .setup-box ol { margin: 20px 0; padding-left: 20px; }
        .setup-box li { margin-bottom: 12px; line-height: 1.6; font-size: 14px; }
        .setup-box a { color: var(--primary); }
        .setup-box textarea { width: 100%; height: 140px; padding: 14px; border: 2px solid var(--border); border-radius: 12px; font-family: monospace; font-size: 12px; margin-bottom: 16px; outline: none; resize: none; }
        .setup-box textarea:focus { border-color: var(--primary); }
        .setup-box .err { color: var(--danger); font-size: 14px; margin-top: 10px; }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .tabs { padding: 8px 12px; }
            .tab { padding: 8px 12px; font-size: 12px; }
            .input-btns { flex-direction: row; }
            .input-btns .btn { flex: 1; }
            .columns { flex-direction: column; }
            .column { max-width: 100%; min-width: 100%; }
            .day-cards { grid-template-columns: 1fr; }
            .form-row, .form-row-3 { grid-template-columns: 1fr; }
            .header-date { display: none; }
            .preset-grid { grid-template-columns: repeat(3, 1fr); }
        }

        @media (min-width: 1024px) {
            .callboard-layout { display: grid; grid-template-columns: 1fr 280px; gap: 20px; }
            .callboard-side { order: 2; }
            .callboard-main { order: 1; }
            .callback-panel { position: sticky; top: 80px; }
        }
    </style>
</head>
<body>
    <div class="setup-bg" id="setup">
        <div class="setup-box">
            <h2>
                <div class="logo-icon"><div style="width:20px;height:20px;background:white;border-radius:3px;transform:rotate(-5deg);"></div></div>
                Sticki
            </h2>
            <p class="sub">ì‹¤ì‹œê°„ ë™ê¸°í™”ë¥¼ ìœ„í•´ Firebaseë¥¼ ì—°ê²°í•´ì£¼ì„¸ìš”</p>
            <ol>
                <li><a href="https://console.firebase.google.com/" target="_blank">Firebase Console</a> â†’ í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°</li>
                <li>Realtime Database â†’ ë§Œë“¤ê¸° â†’ í…ŒìŠ¤íŠ¸ ëª¨ë“œ</li>
                <li>í”„ë¡œì íŠ¸ ì„¤ì • â†’ ë‚´ ì•± â†’ ì›¹ ì¶”ê°€</li>
                <li>firebaseConfig ë³µì‚¬ í›„ ë¶™ì—¬ë„£ê¸°</li>
            </ol>
            <textarea id="cfgInput" placeholder="const firebaseConfig = { ... }"></textarea>
            <button class="btn btn-primary" style="width:100%;" onclick="saveConfig()">ì—°ê²°í•˜ê¸°</button>
            <p class="err" id="cfgErr"></p>
        </div>
    </div>

    <div class="app">
        <header class="header">
            <div class="logo">
                <div class="logo-icon"></div>
                <h1>Stick<span>i</span></h1>
            </div>
            <div class="header-right">
                <span class="header-date" id="hDate"></span>
                <div class="sync-badge"><span class="sync-dot" id="syncDot"></span><span id="syncTxt">ì—°ê²°ë¨</span></div>
                <button class="icon-btn" onclick="migrateOldCards(true)" title="ë¯¸ì™„ë£Œ ê±´ ì˜¤ëŠ˜ë¡œ ì´ì›”">ğŸ“¥</button>
                <button class="icon-btn" onclick="switchTab('settings')">âš™</button>
            </div>
        </header>

        <nav class="tabs">
            <button class="tab active" data-t="callboard" onclick="switchTab('callboard')"><span class="icon">ğŸ“‹</span> ìŠ¤í‹°í‚¤</button>
            <button class="tab" data-t="mainboard" onclick="switchTab('mainboard')"><span class="icon">ğŸ“…</span> ë³´ë“œ</button>
            <button class="tab" data-t="log" onclick="switchTab('log')"><span class="icon">ğŸ”</span> ë¡œê·¸</button>
            <button class="tab" data-t="settings" onclick="switchTab('settings')"><span class="icon">âš™</span> ì„¤ì •</button>
        </nav>

        <main class="main">
            <!-- ìŠ¤í‹°í‚¤ë³´ë“œ -->
            <div class="screen active" id="callboardScreen">
                <div class="callboard-layout">
                    <div class="callboard-side">
                        <div class="callback-panel" id="cbPanel">
                            <div class="callback-header">
                                <h3>â° ì˜¤ëŠ˜ ì½œë°±</h3>
                                <span class="callback-count" id="cbCnt">0</span>
                            </div>
                            <div class="callback-list" id="cbList"><span style="font-size:12px;color:var(--text-sub);">ì½œë°± ì—†ìŒ</span></div>
                        </div>
                    </div>
                    <div class="callboard-main">
                        <div class="input-box">
                            <textarea id="inArea" placeholder="ì…ë ¥ ë˜ëŠ” ë¶™ì—¬ë„£ê¸°...&#10;ì˜ˆ: í…Œì´í¬ì—  ê¹€ì‚¬ì¥ 010-1234-5678 ë‚´ì¼ 2ì‹œ í†µí™”"></textarea>
                            <div class="input-btns">
                                <button class="btn btn-primary" onclick="smartParse()">+ ì¶”ê°€</button>
                                <button class="btn btn-light" onclick="openAdd()">ìƒì„¸ì…ë ¥</button>
                            </div>
                        </div>
                        <div class="columns" id="cols"></div>
                    </div>
                </div>
            </div>

            <!-- ë©”ì¸ë³´ë“œ -->
            <div class="screen" id="mainboardScreen">
                <div class="mb-nav">
                    <button onclick="shiftD(-3)">â—€</button>
                    <span id="mbRange"></span>
                    <button onclick="shiftD(3)">â–¶</button>
                </div>
                <div class="day-cards" id="dayCards"></div>
            </div>

            <!-- ë¡œê·¸ -->
            <div class="screen" id="logScreen">
                <div class="search-wrap">
                    <div class="search-row">
                        <input type="text" id="searchIn" placeholder="ì—…ì²´ëª…, ì „í™”ë²ˆí˜¸, ë©”ëª¨ ê²€ìƒ‰..." oninput="renderLogs()">
                        <button class="btn btn-primary" onclick="renderLogs()">ê²€ìƒ‰</button>
                    </div>
                    <div class="filters">
                        <button class="filter active" data-f="all" onclick="setF('all')">ì „ì²´</button>
                        <button class="filter" data-f="ongoing" onclick="setF('ongoing')">ì§„í–‰ì¤‘</button>
                        <button class="filter" data-f="done" onclick="setF('done')">ì™„ë£Œ</button>
                    </div>
                </div>
                <div class="log-list" id="logList"></div>
            </div>

            <!-- ì„¤ì • -->
            <div class="screen" id="settingsScreen">
                <div class="settings-box">
                    <h3>ğŸ“¦ í”„ë¦¬ì…‹</h3>
                    <div class="preset-grid" id="presetGrid"></div>
                </div>
                <div class="settings-box">
                    <h3>ğŸ“ ë‹¨ê³„ ì„¤ì •</h3>
                    <div class="stage-list" id="stageList"></div>
                    <button class="add-stage" onclick="addStage()">+ ë‹¨ê³„ ì¶”ê°€</button>
                </div>
                <div class="settings-box">
                    <h3>ğŸ’¾ ë°ì´í„°</h3>
                    <div style="display:flex;gap:8px;flex-wrap:wrap;">
                        <button class="btn btn-light" onclick="exportD()">ğŸ“¤ ë‚´ë³´ë‚´ê¸°</button>
                        <button class="btn btn-light" onclick="importD()">ğŸ“¥ ê°€ì ¸ì˜¤ê¸°</button>
                        <button class="btn btn-light" onclick="resetCfg()">ğŸ”„ ì¬ì—°ê²°</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ëª¨ë‹¬ -->
    <div class="modal-bg" id="modal">
        <div class="modal">
            <div class="modal-head">
                <h2 id="mTitle">ì¶”ê°€</h2>
                <button class="modal-close" onclick="closeM()">âœ•</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editId">
                <div class="form-row">
                    <div class="form-group"><label>ì—…ì²´/ì´ë¦„ *</label><input id="f_company" placeholder="ì—…ì²´ëª… ë˜ëŠ” ì´ë¦„"></div>
                    <div class="form-group"><label>ì—°ë½ì²˜</label><input id="f_contact" placeholder="010-0000-0000"></div>
                </div>
                <div class="form-row form-row-3">
                    <div class="form-group"><label>ëŒ€í‘œ/ë‹´ë‹¹</label><input id="f_ceo"></div>
                    <div class="form-group"><label>êµ¬ë¶„</label><select id="f_type"><option value="">ì„ íƒ</option><option>ë²•ì¸</option><option>ê°œì¸</option></select></div>
                    <div class="form-group"><label>ë‹¨ê³„</label><select id="f_stage"></select></div>
                </div>
                <div class="form-group"><label>ì—…ì¢…/ë¶„ë¥˜</label><input id="f_industry"></div>
                <div class="form-row">
                    <div class="form-group"><label>ì½œë°±/ì˜ˆì•½</label><input id="f_callback" placeholder="ì˜¤í›„ 2ì‹œ, ë‚´ì¼ 3PM"></div>
                    <div class="form-group"><label>ê¸°í•œ/ë§ˆê°</label><input id="f_deadline" placeholder="1/15, ê¸ˆìš”ì¼ê¹Œì§€"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>ìš°ì„ ìˆœìœ„</label><select id="f_priority"><option value="">ë³´í†µ</option><option value="urgent">ğŸ”´ ê¸´ê¸‰</option><option value="high">ğŸŸ  ë†’ìŒ</option></select></div>
                    <div class="form-group"><label>ìƒíƒœë©”ëª¨</label><input type="text" id="f_status" placeholder="ì§ì ‘ ì…ë ¥ ë˜ëŠ” ì•„ë˜ ì„ íƒ"><div class="status-chips"><span onclick="setStatus('ë¶€ì¬ì¤‘')">ë¶€ì¬ì¤‘</span><span onclick="setStatus('ì¬í†µí™”')">ì¬í†µí™”</span><span onclick="setStatus('ìë£Œìš”ì²­')">ìë£Œìš”ì²­</span><span onclick="setStatus('ê²€í† ì¤‘')">ê²€í† ì¤‘</span><span onclick="setStatus('í™•ì¸í•„ìš”')">í™•ì¸í•„ìš”</span><span onclick="setStatus('ë³´ë¥˜')">ë³´ë¥˜</span><span onclick="setStatus('')">âœ•</span></div></div>
                </div>
                <div class="form-group"><label>ë‹´ë‹¹ì</label><div class="form-row form-row-3"><input id="f_s1" placeholder="1ë‹¨ê³„"><input id="f_s2" placeholder="2ë‹¨ê³„"><input id="f_s3" placeholder="3ë‹¨ê³„"></div></div>
                <div class="form-group"><label>ë©”ëª¨</label><textarea id="f_memo" rows="3" placeholder="ì¶”ê°€ ë©”ëª¨..."></textarea></div>
            </div>
            <div class="modal-foot">
                <button class="btn btn-danger" id="delBtn" style="display:none;" onclick="delCard()">ì‚­ì œ</button>
                <button class="btn btn-light" onclick="closeM()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="saveCard()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script>
        const CFG_KEY='sticki_cfg',SET_KEY='sticki_set',COLORS=['yellow','pink','blue','green','orange','purple'];
        const PRESETS={
            sales:{n:'ì˜ì—…ìš©',i:'ğŸ“',s:['ì ‘ìˆ˜','1ì°¨ì½œ','2ì°¨ì½œ','ê³„ì•½','ì™„ë£Œ']},
            office:{n:'ì‚¬ë¬´ì§ìš©',i:'ğŸ’¼',s:['ì ‘ìˆ˜','ì²˜ë¦¬ì¤‘','ì²˜ë¦¬ì™„ë£Œ']},
            shop:{n:'ì‚¬ì¥ë‹˜ìš©',i:'ğŸ’…',s:['ì˜ˆì•½ì ‘ìˆ˜','ë°©ë¬¸ì˜ˆì •','ì™„ë£Œ']},
            simple:{n:'ë‹¨ìˆœê´€ë¦¬',i:'âœ…',s:['í• ì¼','ì™„ë£Œ']},
            freelancer:{n:'í”„ë¦¬ëœì„œ',i:'ğŸ¨',s:['ë¬¸ì˜','ì§„í–‰','ì™„ë£Œ']}
        };
        let db=null,cards={},set={preset:'sales',stages:['ì ‘ìˆ˜','1ì°¨ì½œ','2ì°¨ì½œ','ê³„ì•½','ì™„ë£Œ']},vDate=kstDate(),mbOff=0,logF='all';

        // ìœ í‹¸ë¦¬í‹°
        function kstDate(){const n=new Date();return new Date(n.getTime()+(n.getTimezoneOffset()*60000)+(9*60*60000)).toISOString().split('T')[0];}
        function fmtDate(d){const x=new Date(d+'T00:00:00'),wd=['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];return `${x.getMonth()+1}ì›” ${x.getDate()}ì¼ ${wd[x.getDay()]}ìš”ì¼`;}
        function fmtShort(d){const x=new Date(d+'T00:00:00');return `${x.getMonth()+1}/${x.getDate()}`;}
        function fmtDateTime(iso){const x=new Date(iso);return `${x.getMonth()+1}/${x.getDate()} ${x.getHours().toString().padStart(2,'0')}:${x.getMinutes().toString().padStart(2,'0')}`;}
        function addD(d,n){const x=new Date(d+'T00:00:00');x.setDate(x.getDate()+n);return x.toISOString().split('T')[0];}
        function isLast(s){return set.stages.indexOf(s)===set.stages.length-1;}

        // ì´ˆê¸°í™”
        window.onload=()=>{
            loadSet();
            document.getElementById('hDate').textContent=fmtDate(vDate);
            const c=localStorage.getItem(CFG_KEY);
            if(c){try{initFB(JSON.parse(c));document.getElementById('setup').style.display='none';}catch(e){}}
            setInterval(chkMid,60000);
        };

        function loadSet(){const s=localStorage.getItem(SET_KEY);if(s)set=JSON.parse(s);renderPresets();renderStages();}
        function saveSet(){localStorage.setItem(SET_KEY,JSON.stringify(set));renderCols();renderCards();updStageOpt();}

        // Firebase
        function saveConfig(){
            const i=document.getElementById('cfgInput').value,e=document.getElementById('cfgErr');
            try{
                const c=i.replace(/\r?\n/g,' ').replace(/\s+/g,' ');
                const ext=n=>{const m=c.match(new RegExp(n+'\\s*:\\s*["\']([^"\']+)["\']'));return m?m[1]:'';};
                const cfg={apiKey:ext('apiKey'),authDomain:ext('authDomain'),databaseURL:ext('databaseURL'),projectId:ext('projectId'),storageBucket:ext('storageBucket'),messagingSenderId:ext('messagingSenderId'),appId:ext('appId')};
                if(!cfg.apiKey||!cfg.databaseURL)throw'apiKey ë˜ëŠ” databaseURL ëˆ„ë½';
                localStorage.setItem(CFG_KEY,JSON.stringify(cfg));
                initFB(cfg);
                document.getElementById('setup').style.display='none';
            }catch(x){e.textContent='âŒ '+x;}
        }

        function initFB(c){
            if(!firebase.apps.length)firebase.initializeApp(c);
            db=firebase.database();
            db.ref('.info/connected').on('value',s=>{
                document.getElementById('syncDot').classList.toggle('off',!s.val());
                document.getElementById('syncTxt').textContent=s.val()?'ì—°ê²°ë¨':'ì˜¤í”„ë¼ì¸';
            });
            // ì‹¤ì‹œê°„ ë™ê¸°í™”
            db.ref('cards').on('value',s=>{
                cards=s.val()||{};
                renderCols();renderCards();renderCB();renderMB();renderLogs();
            });
            // ì´ˆê¸° ë¡œë“œ í›„ ì´ì›” ì²´í¬ (1ì´ˆ ë”œë ˆì´ë¡œ ë°ì´í„° ë¡œë“œ ë³´ì¥)
            setTimeout(()=>migrateOldCards(false), 1000);
        }

        // ê³¼ê±° ë¯¸ì™„ë£Œ ê±´ ì˜¤ëŠ˜ë¡œ ì´ì›”
        function migrateOldCards(manual=false){
            if(!db)return;
            const today=kstDate();
            const lastStage=set.stages[set.stages.length-1];
            let cnt=0;
            let targets=[];
            
            Object.values(cards).forEach(c=>{
                if(!c || !c.currentDate || !c.stage) return;
                const isOld = c.currentDate < today;
                const isNotDone = c.stage !== lastStage;
                if(isOld && isNotDone){
                    targets.push(c);
                    db.ref('cards/'+c.id).update({currentDate:today});
                    cnt++;
                }
            });
            
            if(cnt>0){
                console.log(`[Sticki] ${cnt}ê±´ ì´ì›” ì™„ë£Œ:`, targets.map(t=>t.company).join(', '));
                showToast(`ğŸ“Œ ${cnt}ê±´ì´ ì˜¤ëŠ˜ë¡œ ì´ì›”ë˜ì—ˆìŠµë‹ˆë‹¤`);
            } else if(manual){
                showToast('ì´ì›”í•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤');
            }
        }
        
        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€
        function showToast(msg){
            let t=document.getElementById('toast');
            if(!t){
                t=document.createElement('div');
                t.id='toast';
                t.style.cssText='position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:12px 24px;border-radius:8px;font-size:14px;z-index:9999;opacity:0;transition:opacity 0.3s;';
                document.body.appendChild(t);
            }
            t.textContent=msg;
            t.style.opacity='1';
            setTimeout(()=>t.style.opacity='0',3000);
        }

        function resetCfg(){if(confirm('ì¬ì—°ê²°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){localStorage.removeItem(CFG_KEY);location.reload();}}

        // ìì • ì²´í¬
        let lastD=kstDate();
        function chkMid(){
            const t=kstDate();
            if(t!==lastD){
                lastD=t;
                Object.values(cards).forEach(c=>{if(c.currentDate===addD(t,-1)&&!isLast(c.stage))db.ref('cards/'+c.id).update({currentDate:t});});
                vDate=t;
                document.getElementById('hDate').textContent=fmtDate(vDate);
                renderCards();
            }
        }

        // íƒ­
        function switchTab(t){
            document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
            document.getElementById(t+'Screen').classList.add('active');
            document.querySelector(`[data-t="${t}"]`).classList.add('active');
            if(t==='mainboard')renderMB();
            if(t==='log')renderLogs();
            if(t==='settings'){renderPresets();renderStages();}
        }

        // ìŠ¤ë§ˆíŠ¸ íŒŒì‹±
        function smartParse(){
            const raw=document.getElementById('inArea').value.trim();
            if(!raw)return;

            const data={company:'',contact:'',ceo:'',type:'',industry:'',callback:'',deadline:'',priority:'',statusMemo:'',staff1:'',staff2:'',staff3:'',memo:'',stage:set.stages[0],originDate:vDate,currentDate:vDate,color:COLORS[Object.keys(cards).length%COLORS.length]};

            let text=raw;

            // 0. ë‚ ì§œ íŒ¨í„´ ì œê±° (íšŒì‚¬ëª…ìœ¼ë¡œ ì˜¤ì¸ ë°©ì§€)
            const datePatterns=[
                /^\d{1,2}\/\d{1,2}\s*/,  // 1/19
                /^\d{1,2}\.\d{1,2}\s*/,  // 1.19
                /^\d{1,2}ì›”\s*\d{1,2}ì¼?\s*/,  // 1ì›” 19ì¼
                /^\d{4}[-\/\.]\d{1,2}[-\/\.]\d{1,2}\s*/,  // 2026-01-19
                /\d{1,2}\/\d{1,2}/g,  // ì¤‘ê°„ì— ìˆëŠ” ë‚ ì§œ
                /\d{1,2}\.\d{1,2}(?!\d)/g  // ì¤‘ê°„ì— ìˆëŠ” ë‚ ì§œ (ì†Œìˆ˜ì  ì œì™¸)
            ];
            for(const p of datePatterns){
                text=text.replace(p,' ');
            }

            // 0-1. ëŒ€ê´„í˜¸ íƒœê·¸ ì œê±° [ì†¡ë¦¼] ë“±
            text=text.replace(/\[[^\]]+\]/g,' ');

            // 1. ì—°ë½ì²˜ ì¶”ì¶œ (ì–´ë””ì— ìˆë“ )
            const phonePatterns=[
                /(01[016789])[-.\s]?(\d{3,4})[-.\s]?(\d{4})/g,  // íœ´ëŒ€í°
                /(02|0[3-6][1-5])[-.\s]?(\d{3,4})[-.\s]?(\d{4})/g,  // ì¼ë°˜ì „í™”
                /(\d{4})[-.\s]?(\d{4})/g  // êµ­ë²ˆì—†ëŠ” ë²ˆí˜¸
            ];

            for(const p of phonePatterns){
                const m=text.match(p);
                if(m&&m[0]){
                    data.contact=m[0].replace(/[-.\s]/g,'');
                    text=text.replace(m[0],'  ');
                    break;
                }
            }

            // 2. ì´ë¦„ ì¶”ì¶œ (ì§í•¨ íŒ¨í„´)
            const namePatterns=[
                /([ê°€-í£]{2,4})\s*(ëŒ€í‘œ|ì‚¬ì¥|ë‹˜|ì”¨|ë‹´ë‹¹|ê³¼ì¥|ë¶€ì¥|ì°¨ì¥|ì´ì‚¬|ì‹¤ì¥|íŒ€ì¥|ì›ì¥|ì„ ìƒ|ê³ ê°)/,
                /([ê°€-í£]{2,4})(ì…ë‹ˆë‹¤|ì—ìš”|ì´ì—ìš”|ì˜ˆìš”)/,
                /(ëŒ€í‘œ|ì‚¬ì¥|ë‹´ë‹¹|ê³¼ì¥|ë¶€ì¥)\s*([ê°€-í£]{2,4})/
            ];

            for(const p of namePatterns){
                const m=text.match(p);
                if(m){
                    data.ceo=m[1]||m[2];
                    text=text.replace(m[0],'  ');
                    break;
                }
            }

            // 2-1. ì§í•¨ ì—†ëŠ” ì´ë¦„ ì¶”ì¶œ (íšŒì‚¬ëª… íŒ¨í„´ ë’¤ ë˜ëŠ” ì „í™”ë²ˆí˜¸ ë’¤)
            if(!data.ceo){
                // ì „í™”ë²ˆí˜¸ ë’¤ì— ì˜¤ëŠ” 2~3ê¸€ì í•œê¸€ ì´ë¦„
                const nameAfterPhone=raw.match(/\d{4}\s+[ê°€-í£A-Za-z]+\s+([ê°€-í£]{2,3})(?:\s|$)/);
                if(nameAfterPhone)data.ceo=nameAfterPhone[1];
            }

            // 3. íšŒì‚¬ëª… ì¶”ì¶œ (ë²•ì¸/íŠ¹ì • íŒ¨í„´)
            const companyPatterns=[
                /(\(ì£¼\)|ì£¼ì‹íšŒì‚¬|ãˆœ)\s*([ê°€-í£A-Za-z0-9]+)/,
                /([ê°€-í£A-Za-z0-9]+)\s*(\(ì£¼\)|ì£¼ì‹íšŒì‚¬|ãˆœ)/,
                /([ê°€-í£A-Za-z]{2,})(ë³‘ì›|ì˜ì›|ì•½êµ­|ì„¼í„°|í•™ì›|ìƒµ|ë„¤ì¼|ë¯¸ìš©|í—¤ì–´|íƒ€íˆ¬|ë¬¸ì‹ |ìŠ¤íŠœë””ì˜¤|ê³µë°©|ì¹´í˜|ì‹ë‹¹|ë§›ì§‘|ë§ˆíŠ¸|ìŠ¤í† ì–´|ëª°|ìˆ|í‘¸ë“œ|ì¹˜í‚¨|í”¼ì)/,
                /([ê°€-í£A-Za-z]{2,})(ì‚°ì—…|ê±´ì„¤|ë¬´ì—­|ìƒì‚¬|ê¸°ì—…|í…Œí¬|ì†Œí”„íŠ¸|ì‹œìŠ¤í…œ|ì†”ë£¨ì…˜|ì»´í¼ë‹ˆ|ì½”í¼ë ˆì´ì…˜|í™€ë”©ìŠ¤|ê·¸ë£¹|ì¸í„°ë‚´ì…”ë„)/
            ];

            for(const p of companyPatterns){
                const m=text.match(p);
                if(m){
                    data.company=m[0].trim();
                    text=text.replace(m[0],'  ');
                    break;
                }
            }

            // 4. ì½œë°±/ì˜ˆì•½ ì‹œê°„ ì¶”ì¶œ
            const timePatterns=[
                /(ì˜¤ëŠ˜|ë‚´ì¼|ëª¨ë ˆ|ë‹¤ìŒì£¼|ì´ë²ˆì£¼)\s*(ì˜¤ì „|ì˜¤í›„)?\s*(\d{1,2}ì‹œ|\d{1,2}:\d{2}|\d{1,2}pm|\d{1,2}am)?/i,
                /(ì§€ê¸ˆ|ë°”ë¡œ|ì¦‰ì‹œ)/,
                /(\d{1,2})\s*(ì‹œ|PM|AM|pm|am)/i,
                /(ì˜¤ì „|ì˜¤í›„)\s*(\d{1,2})\s*(ì‹œ)?/,
                /(\d{1,2}:\d{2})/
            ];

            for(const p of timePatterns){
                const m=text.match(p);
                if(m&&(text.includes('í†µí™”')||text.includes('ì½œë°±')||text.includes('ì—°ë½')||text.includes('ì „í™”')||text.includes('ì˜ˆì•½')||text.includes('ì›í•¨')||text.includes('ì§€ê¸ˆ')||text.includes('ë°”ë¡œ'))){
                    data.callback=m[0].trim();
                    if(set.stages.length>1)data.stage=set.stages[1];
                    break;
                }else if(m){
                    data.callback=m[0].trim();
                    break;
                }
            }

            // 5. ìƒíƒœë©”ëª¨ ì¶”ì¶œ
            const statusMap={'ë¶€ì¬':'ë¶€ì¬ì¤‘','ì¬í†µí™”':'ì¬í†µí™”','ìë£Œìš”ì²­':'ìë£Œìš”ì²­','ìë£Œ ìš”ì²­':'ìë£Œìš”ì²­','ê²€í† ':'ê²€í† ì¤‘','ë³´ë¥˜':'ë³´ë¥˜','í™•ì¸í•„ìš”':'í™•ì¸í•„ìš”','í™•ì¸ í•„ìš”':'í™•ì¸í•„ìš”','ì™„ë£Œ':'ìë£Œì™„ë£Œ','ê³„ì•½':'ê³„ì•½ì™„ë£Œ'};
            for(const[k,v]of Object.entries(statusMap)){
                if(text.includes(k)){data.statusMemo=v;break;}
            }

            // 6. ë²•ì¸/ê°œì¸ êµ¬ë¶„
            if(text.includes('ë²•ì¸'))data.type='ë²•ì¸';
            else if(text.includes('ê°œì¸'))data.type='ê°œì¸';

            // 7. ë‚¨ì€ í…ìŠ¤íŠ¸ì—ì„œ íšŒì‚¬ëª… ì¶”ì¶œ (ì•„ì§ ì—†ìœ¼ë©´)
            if(!data.company){
                const words=text.split(/[\s,\-\/]+/).filter(w=>w.length>=2&&/^[ê°€-í£A-Za-z][ê°€-í£A-Za-z0-9]*$/.test(w));
                const exclude=['í†µí™”','ì—°ë½','ì „í™”','ì½œë°±','ì˜ˆì•½','ë¶€ì¬','ìë£Œ','ìš”ì²­','ê²€í† ','ë³´ë¥˜','í™•ì¸','ë²•ì¸','ê°œì¸','ëŒ€í‘œ','ì‚¬ì¥','ë‹´ë‹¹','ì˜¤ëŠ˜','ë‚´ì¼','ëª¨ë ˆ','ì˜¤ì „','ì˜¤í›„','ì§€ê¸ˆ','ë°”ë¡œ','ì¦‰ì‹œ','ì›í•¨','ê¸°ì¥','ë§¤ì¶œ','ì¸ê±´ë¹„','ì‹ ê³ ','ì—…ë ¥','ì‘ë…„','ì˜¬í•´','ì»¨ì„¤íŒ…','ë¬´ì—­','ì „ì‹œ','ë¬´ì‹¤ì ','ê°€ê¹Œì´','ë¬¸ì˜','ê¸°ì¥ë£Œ','ì›”ë¶€í„°'];
                for(const w of words){
                    // ìˆ«ìë¡œë§Œ ëœ ë‹¨ì–´, ë‚ ì§œ íŒ¨í„´, ì œì™¸ ë‹¨ì–´ ìŠ¤í‚µ
                    if(/^\d+$/.test(w))continue;
                    if(/^\d+[ì›”ì¼ì‹œ]/.test(w))continue;
                    if(!exclude.some(e=>w.includes(e))&&w!==data.ceo){
                        data.company=w;
                        break;
                    }
                }
            }

            // 8. ë‚˜ë¨¸ì§€ â†’ ë©”ëª¨
            let memo=text;
            [data.contact,data.ceo,data.company,data.callback].forEach(v=>{if(v)memo=memo.replace(v,'');});
            memo=memo.replace(/[\s,\-]+/g,' ').trim();
            if(memo.length>2)data.memo=memo;

            // 9. ìµœì¢… ì •ë¦¬
            if(!data.company&&data.contact)data.company=data.contact;
            if(!data.company&&data.ceo)data.company=data.ceo;
            if(!data.company)data.company=raw.substring(0,20);

            addCard(data);
            document.getElementById('inArea').value='';
        }

        function addCard(d){if(!db)return;const id=Date.now().toString();d.id=id;d.createdAt=new Date().toISOString();db.ref('cards/'+id).set(d);}

        // ì¹¼ëŸ¼ ë Œë”ë§
        function renderCols(){
            document.getElementById('cols').innerHTML=set.stages.map((s,i)=>`
                <div class="column" data-si="${i}" ondrop="onDrop(event)" ondragover="onDragOver(event)" ondragenter="onDragEnter(event)" ondragleave="onDragLeave(event)">
                    <div class="col-header">
                        <span class="col-title"><span class="col-dot"></span>${s}</span>
                        <span class="col-count" id="cnt${i}">0</span>
                    </div>
                    <div class="col-cards" data-si="${i}"></div>
                </div>
            `).join('');
        }

        function onDragOver(e){e.preventDefault();e.dataTransfer.dropEffect='move';}
        function onDragEnter(e){e.preventDefault();e.currentTarget.classList.add('drag-over');}
        function onDragLeave(e){if(!e.currentTarget.contains(e.relatedTarget))e.currentTarget.classList.remove('drag-over');}
        function onDrop(e){e.preventDefault();e.currentTarget.classList.remove('drag-over');const id=e.dataTransfer.getData('text/plain'),si=parseInt(e.currentTarget.dataset.si),ns=set.stages[si];if(db&&id&&ns)db.ref('cards/'+id).update({stage:ns});}

        function getStatusClass(s){return{'ë¶€ì¬ì¤‘':'red','ë¶€ì¬':'red','ì¬í†µí™”':'red','í†µí™”ë¶ˆê°€':'red','ìë£Œìš”ì²­':'blue','ìë£Œìš”ì²­ì¤‘':'blue','ìë£ŒëŒ€ê¸°':'blue','ê²€í† ì¤‘':'blue','í™•ì¸í•„ìš”':'purple','ìë£Œìš”ì²­í•„ìš”':'purple','ë³´ë¥˜':'orange','ê±°ì ˆ':'red','ì™„ë£Œ':'green','ìë£Œì™„ë£Œ':'green','ì§„í–‰OK':'green','ê³„ì•½ì™„ë£Œ':'green'}[s]||'blue';}

        function renderCards(){
            set.stages.forEach((_,i)=>{const c=document.querySelector(`.col-cards[data-si="${i}"]`);if(c)c.innerHTML='';});
            const tc=Object.values(cards).filter(c=>c.currentDate===vDate);
            tc.forEach((c,x)=>{
                const si=set.stages.indexOf(c.stage);if(si<0)return;
                const con=document.querySelector(`.col-cards[data-si="${si}"]`);if(!con)return;
                const el=document.createElement('div');
                el.className=`card ${c.color||COLORS[x%COLORS.length]}`;
                el.draggable=true;
                // í˜¸ë²„ ì‹œ ì…ë ¥ ì‹œê°„ í‘œì‹œ
                const createdTime=c.createdAt?fmtDateTime(c.createdAt):'';
                el.title=createdTime?`ì…ë ¥: ${createdTime}`:'';
                el.onclick=()=>openEdit(c.id);
                el.ondragstart=e=>{e.dataTransfer.setData('text/plain',c.id);e.dataTransfer.effectAllowed='move';el.classList.add('dragging');};
                el.ondragend=()=>el.classList.remove('dragging');
                let bg=[];
                if(c.callback)bg.push(`<span class="badge callback">â° ${c.callback}</span>`);
                if(c.priority==='urgent')bg.push(`<span class="badge urgent">ê¸´ê¸‰</span>`);
                if(c.priority==='high')bg.push(`<span class="badge urgent" style="background:#ff922b">ë†’ìŒ</span>`);
                if(c.deadline)bg.push(`<span class="badge deadline">ğŸ“… ${c.deadline}</span>`);
                let st='';
                if(c.staff1||c.staff2||c.staff3){
                    st='<div class="card-staff">';
                    if(c.staff1)st+=`<span class="staff-tag">${set.stages[0]||'1'}:${c.staff1}</span>`;
                    if(c.staff2&&set.stages[1])st+=`<span class="staff-tag">${set.stages[1]}:${c.staff2}</span>`;
                    if(c.staff3&&set.stages[2])st+=`<span class="staff-tag">${set.stages[2]}:${c.staff3}</span>`;
                    st+='</div>';
                }
                const statusHtml=c.statusMemo?`<span class="card-status ${getStatusClass(c.statusMemo)}">${c.statusMemo}</span>`:'';
                el.innerHTML=`
                    <div class="card-date">${fmtShort(c.originDate||c.currentDate)}</div>
                    <div class="card-title">${c.company||'(ë¯¸ì…ë ¥)'}</div>
                    ${c.contact?`<div class="card-info">ğŸ“ ${c.contact}</div>`:''}
                    ${c.ceo?`<div class="card-info">ğŸ‘¤ ${c.ceo}</div>`:''}
                    ${st}
                    ${bg.length?`<div class="card-badges">${bg.join('')}</div>`:''}
                    ${statusHtml}
                `;
                con.appendChild(el);
            });
            set.stages.forEach((_,i)=>{const cnt=tc.filter(c=>c.stage===set.stages[i]).length;const el=document.getElementById('cnt'+i);if(el)el.textContent=cnt;});
        }

        // ì½œë°±
        function renderCB(){
            const t=kstDate(),cbs=Object.values(cards).filter(c=>c.callback&&c.currentDate===t&&!isLast(c.stage));
            document.getElementById('cbCnt').textContent=cbs.length;
            document.getElementById('cbList').innerHTML=cbs.length?cbs.map(c=>`<div class="callback-chip" onclick="openEdit('${c.id}')"><div class="time">${c.callback}</div><div class="name">${c.company}</div></div>`).join(''):'<span style="font-size:12px;color:var(--text-sub);">ì½œë°± ì—†ìŒ âœ¨</span>';
        }

        // ëª¨ë‹¬
        function openAdd(){document.getElementById('mTitle').textContent='ì¶”ê°€';document.getElementById('editId').value='';document.getElementById('delBtn').style.display='none';clearF();updStageOpt();document.getElementById('modal').classList.add('active');}
        function openEdit(id){
            const c=cards[id];if(!c)return;
            document.getElementById('mTitle').textContent='ìˆ˜ì •';
            document.getElementById('editId').value=id;
            document.getElementById('delBtn').style.display='block';
            document.getElementById('f_company').value=c.company||'';
            document.getElementById('f_contact').value=c.contact||'';
            document.getElementById('f_ceo').value=c.ceo||'';
            document.getElementById('f_type').value=c.type||'';
            document.getElementById('f_industry').value=c.industry||'';
            document.getElementById('f_callback').value=c.callback||'';
            document.getElementById('f_deadline').value=c.deadline||'';
            document.getElementById('f_priority').value=c.priority||'';
            document.getElementById('f_status').value=c.statusMemo||'';
            document.getElementById('f_s1').value=c.staff1||'';
            document.getElementById('f_s2').value=c.staff2||'';
            document.getElementById('f_s3').value=c.staff3||'';
            document.getElementById('f_memo').value=c.memo||'';
            updStageOpt();
            document.getElementById('f_stage').value=c.stage||set.stages[0];
            document.getElementById('modal').classList.add('active');
        }
        function closeM(){document.getElementById('modal').classList.remove('active');}
        function setStatus(v){document.getElementById('f_status').value=v;}
        function clearF(){['f_company','f_contact','f_ceo','f_industry','f_callback','f_deadline','f_s1','f_s2','f_s3','f_memo'].forEach(i=>document.getElementById(i).value='');document.getElementById('f_type').value='';document.getElementById('f_priority').value='';document.getElementById('f_status').value='';}
        function updStageOpt(){document.getElementById('f_stage').innerHTML=set.stages.map(s=>`<option value="${s}">${s}</option>`).join('');}
        function saveCard(){
            const id=document.getElementById('editId').value,co=document.getElementById('f_company').value.trim();
            if(!co){alert('ì—…ì²´/ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”');return;}
            const d={company:co,contact:document.getElementById('f_contact').value.trim(),ceo:document.getElementById('f_ceo').value.trim(),type:document.getElementById('f_type').value,stage:document.getElementById('f_stage').value||set.stages[0],industry:document.getElementById('f_industry').value.trim(),callback:document.getElementById('f_callback').value.trim(),deadline:document.getElementById('f_deadline').value.trim(),priority:document.getElementById('f_priority').value,statusMemo:document.getElementById('f_status').value,staff1:document.getElementById('f_s1').value.trim(),staff2:document.getElementById('f_s2').value.trim(),staff3:document.getElementById('f_s3').value.trim(),memo:document.getElementById('f_memo').value.trim()};
            if(id){db.ref('cards/'+id).update(d);}else{d.originDate=vDate;d.currentDate=vDate;d.color=COLORS[Object.keys(cards).length%COLORS.length];addCard(d);}
            closeM();
        }
        function delCard(){const id=document.getElementById('editId').value;if(id&&confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){db.ref('cards/'+id).remove();closeM();}}

        // ë©”ì¸ë³´ë“œ
        function renderMB(){
            const t=kstDate(),ds=[addD(t,mbOff-1),addD(t,mbOff),addD(t,mbOff+1)];
            document.getElementById('mbRange').textContent=`${fmtShort(ds[0])} ~ ${fmtShort(ds[2])}`;
            document.getElementById('dayCards').innerHTML=ds.map(d=>{
                const isT=d===t,dc=Object.values(cards).filter(c=>c.currentDate===d),ic=dc.filter(c=>!isLast(c.stage)).length;
                const x=new Date(d+'T00:00:00'),wd=['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
                return `<div class="day-card" onclick="goDate('${d}')"><div class="day-head ${isT?'today':''}"><div class="wd">${wd[x.getDay()]}</div><div class="d">${x.getDate()}</div><span class="cnt ${ic===0?'done':''}">${ic>0?ic:'âœ“'}</span></div><div class="day-body">${dc.length?dc.slice(0,4).map(c=>`<div class="day-item ${c.color||'yellow'}">${c.company}</div>`).join('')+(dc.length>4?`<div style="text-align:center;color:var(--text-sub);font-size:11px;">+${dc.length-4}ê±´</div>`:''):'<div class="day-empty">ì¼ì • ì—†ìŒ</div>'}</div></div>`;
            }).join('');
        }
        function shiftD(n){mbOff+=n;renderMB();}
        function goDate(d){vDate=d;document.getElementById('hDate').textContent=fmtDate(vDate);renderCards();renderCB();switchTab('callboard');}

        // ë¡œê·¸
        function renderLogs(){
            const q=(document.getElementById('searchIn')?.value||'').toLowerCase();
            let cs=Object.values(cards);
            if(logF==='ongoing')cs=cs.filter(c=>!isLast(c.stage));
            else if(logF==='done')cs=cs.filter(c=>isLast(c.stage));
            if(q)cs=cs.filter(c=>(c.company||'').toLowerCase().includes(q)||(c.contact||'').includes(q)||(c.ceo||'').toLowerCase().includes(q)||(c.memo||'').toLowerCase().includes(q));
            cs.sort((a,b)=>new Date(b.createdAt||0)-new Date(a.createdAt||0));
            document.getElementById('logList').innerHTML=cs.length?cs.map(c=>`<div class="log-item" onclick="goCard('${c.id}')"><div class="log-top"><span class="log-title">${c.company}</span><span class="log-date">${fmtShort(c.originDate||c.currentDate)}</span></div><div class="log-info">${c.contact||''} ${c.ceo?'Â· '+c.ceo:''}</div><span class="log-stage">${c.stage}</span></div>`).join(''):'<div style="text-align:center;color:var(--text-sub);padding:40px;">ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</div>';
        }
        function setF(f){logF=f;document.querySelectorAll('.filter').forEach(b=>b.classList.toggle('active',b.dataset.f===f));renderLogs();}
        function goCard(id){const c=cards[id];if(c){vDate=c.currentDate;document.getElementById('hDate').textContent=fmtDate(vDate);renderCards();switchTab('callboard');setTimeout(()=>openEdit(id),200);}}

        // ì„¤ì •
        function renderPresets(){document.getElementById('presetGrid').innerHTML=Object.entries(PRESETS).map(([k,v])=>`<div class="preset-btn ${set.preset===k?'active':''}" data-p="${k}" onclick="selPreset('${k}')"><div class="icon">${v.i}</div><div class="name">${v.n}</div></div>`).join('');}
        function selPreset(p){set.preset=p;set.stages=[...PRESETS[p].s];saveSet();renderPresets();renderStages();}
        function renderStages(){document.getElementById('stageList').innerHTML=set.stages.map((s,i)=>`<div class="stage-item"><span class="num">${i+1}</span><input value="${s}" onchange="updStage(${i},this.value)">${set.stages.length>2?`<button class="del" onclick="remStage(${i})">âœ•</button>`:''}</div>`).join('');}
        function updStage(i,v){set.stages[i]=v;saveSet();}
        function addStage(){if(set.stages.length>=6){alert('ìµœëŒ€ 6ë‹¨ê³„');return;}set.stages.splice(set.stages.length-1,0,'ìƒˆë‹¨ê³„');saveSet();renderStages();}
        function remStage(i){if(set.stages.length<=2)return;set.stages.splice(i,1);saveSet();renderStages();}

        // ë°ì´í„°
        function exportD(){const d=JSON.stringify({cards,settings:set},null,2),b=new Blob([d],{type:'application/json'}),u=URL.createObjectURL(b),a=document.createElement('a');a.href=u;a.download=`sticki_${kstDate()}.json`;a.click();}
        function importD(){const i=document.createElement('input');i.type='file';i.accept='.json';i.onchange=e=>{const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=ev=>{try{const d=JSON.parse(ev.target.result);if(d.cards&&confirm('ê¸°ì¡´ ë°ì´í„°ë¥¼ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?')){db.ref('cards').set(d.cards);if(d.settings){set=d.settings;saveSet();}alert('ì™„ë£Œ!');}}catch(x){alert('íŒŒì¼ ì˜¤ë¥˜');}};r.readAsText(f);};i.click();}

        if('serviceWorker'in navigator)navigator.serviceWorker.register('./sw.js').catch(console.error);
    </script>
</body>
</html>
